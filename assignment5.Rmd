---
title: "Assignment 5"
author: "put your name here"
output: 
  pdf_document:
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message=FALSE,warning=FALSE)
source("assignment5.R")
```
**Section #: `r paste("0",section,sep="")`**


Students must abide by  [UVic
  academic regulations](https://www.uvic.ca/calendar/undergrad/index.php#/policy/Sk_0xsM_V?bc=true&bcCurrent=08%20-%20Policy%20on%20Academic%20Integrity&bcGroup=Undergraduate%20Academic%20Regulations&bcItemType=policies)
 and observe standards of scholarly integrity
(i.e. no plagiarism or cheating). Therefore, this assignment must be
taken individually and not with a friend, classmate, or group. You are
also prohibited from sharing any information about the assignment with
others. I affirm that I will not give or receive any aid on this assignment 
and that all work will be my own. **put your name here**

Recall that in our common pool resource game, groups of $n$ (typically
3) players share a resource where the size, $f$ (fish), is not
known. Each group member $j \in \{1...n\}$ attempts to catch $c_j$
units of fish.  Decisions are made independently and anonymously. If
$(c_1+c_2+c_3<f)$, there is enough fish and each group member receives profit equal to their attempted catch; Otherwise the resource is destroyed and all group members get nothing. For all group sizes the number of fish is a random variable drawn from a uniform distribution
over support $[0,20n]$. Expected profits for individual $j$ are equal
to their attempted catch $c_j$ times the probability that there are enough fish $P(c_1+c_2+c_3<f)$

With a bit of a stretch this game would also apply to the issue of fossil fuel extraction. In this case, the threat is not the extinction of some species we have over-harvested, but our own extinction. A feature of both interpretations is an unknown tipping point beyond which we can not recover. Regarding climate change, a tipping point may be the result of positive feedback loops such as methane being released from permafrost as it thaws, and a lowering of the planet's Albedo as we lose snow and ice cover.  In both cases if extraction stays below the tipping point the species in question will survive, otherwise extinction. The temptation to extract more comes from the fact that our material well being is increasing in extraction, as long as we stay below the tipping point.

The treatments determined how subjects were rematched between rounds.  In the `not` treatment subjects played all 20 rounds with the same group.  In the `randomly` treatment subjects were randomly rematched for each round.  Finally in the `assortatively` treatment subjects played each round with players who had made similar catch request in the previous round.  Higher payoffs can be sustained in common pool resource games if behaviour can be coordinated so that the total catch size $C^{\star\star}=10\times n$.  These treatments were designed to influence how easy it would be to coordinate behaviour. 

# (10 marks)

**For a group of $3$ players, derive the probability there is enough fish $prob(f>c_1+c_2+c_3)$ in terms of $c_1,c_2,c_3$: Hint, draw the probability density function for a uniform distribution over support $[0,60]$ and find the area of the rectangle to the right of $c_1+c_2+c_3$. Using the probability you derived, write out the expected profit function for player 1.  Take the derivative of the expected profit function with respect to $c_1$ and set the derivative equal to zero.  Solve for the symmetric equilibrium where $c_i=c~\forall~i$. What is the equilibrium prediction for catch size for a group of size 3?**


# (10 marks)

**Suppose that a social planner chooses the total catch size $C$. For a group of $3$ players, derive the probability there is enough fish $prob(f>C)$ in terms of $C$: Hint, draw the probability density function for a uniform distribution over support $[0,60]$ and find the area of the rectangle to the right of $C$. Using the probability you derived, write out the expected social welfare (defined to be the expected total catch size).  Take the derivative of the expected social welfare function with respect to $C$ and set the derivative equal to zero, and solve for $C^{\star\star}$.  If $C^{\star\star}$ is the welfare maximizing total catch size, what is the welfare maximizing individual catch size (assuming everyone catches the same amount)?**


# (10 marks) 

**Explain why the equilibrium catch size is different from the socially optimal individual catch size.** 


# (10 marks) 

**When would there be no difference between the equilibrium catch size and the socially optimal catch size? (what number of fishers?)  When does the externality problem get worse? (again, in terms of number of fishers)**


# (10 marks) 

**Using *only the subjects that completed all rounds of the experiment*, make a boxplot of catch size for each treatment.  Hint: you will need to `filter` dataframe `mydf` for only the rows where variable `all_rounds` is true.** 

```{r first_chunk}
#first_plot
```

# (10 marks) 

**What do you see in the above plot?  Why do you think this is the case?**



# (0 marks) 

**Make a heatmap of `choice` where x=`oneid` and y=`round` for those subjects that completed all 20 rounds.**

```{r second_chunk, fig.width=10, fig.height=6}
heatmap.2(mymat, 
          dendrogram='none',     
          Rowv=FALSE,
          Colv=FALSE,
          key=TRUE, 
          key.xlab="catch size",
          key.title="",
          density.info="density",
          trace="none",
          col = viridis::viridis_pal(),
          labCol = colnames(mymat),
          ylab="round number",
          colsep=1:ncol(mymat), # Add vertical grid lines
          rowsep=1:nrow(mymat), # Add horizontal grid lines
          sepcolor = "black",
          keysize=2,
          cexCol=.55
)
```

# (10 marks) 

**In general what do heat maps show us? In this case, what do you see (in terms of relationship between treatment and catch size)?**


# (10 marks) 

**Using dataframe `mydf` make a scatterplot with x=`choice`, y=`profit` and colour=`rematching`, *again for those students that completed all 20 rounds*. Use `geom_jitter` to avoid overplotting.  Add in a smoother with `geom_smooth()`. Do NOT set `method="lm"` in `geom_smooth`.**

```{r third_chunk}
#third_plot
```

# (10 marks) 

**What do you see in the above plot? Specifically what do the points represent, and what do the lines represent? Explain why you think the lines differ by treatment.**

    
 
# (10 marks) 

**Filtering a dataset will introduce selection bias when choices differ systematically with the filtering criteria. All of the above plots were based on the choices of the subjects who completed all 20 rounds of the experiment: We should check to make sure our results are not due to this filtering. To compare the choices of the subjects that dropped out (or were kicked out) make a boxplot of catch size for each treatment for both those who completed 20 rounds, and those who did not.  Hint: you should have two boxplots for each of the 3 treatments, for a total of 6 boxplots.  In `aes()` set `fill=all_rounds` and use `geom_point(position=position_jitterdodge())`. What do you see?** 


```{r fourth_chunk}
#fourth_plot
```

